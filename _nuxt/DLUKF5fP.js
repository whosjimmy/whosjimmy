import{d as I,M as Q,u as j,j as O,r as c,C as v,a as Y,c as n,o as i,b as s,i as A,w as D,v as G,h as S,t as l,N as V,O as P,P as H,Q as E,e as J,R as K,S as W,T as X,U as Z,_ as ss}from"./DsRIpS39.js";const ts={class:"user-management"},es={class:"header"},as={class:"header-actions"},ls={key:0,class:"loading"},ns={key:1,class:"error"},is={key:2,class:"content"},os={class:"stats"},ds={class:"stat-card"},rs={class:"stat-value"},us={class:"stat-card"},cs={class:"stat-value"},vs={class:"stat-card"},ms={class:"stat-value"},ps={class:"table-container"},hs={class:"users-table"},gs={class:"user-email"},bs={class:"user-name"},_s={class:"checkbox-container"},ys=["onUpdate:modelValue","disabled","onChange"],fs={class:"date-cell"},As={class:"date-cell"},ws={class:"actions"},ks={key:0,class:"btn-action btn-loading",disabled:""},Us=["title","onClick"],Cs={key:0,class:"no-results"},xs={key:0,class:"pagination"},Ls=["disabled"],Ns={class:"page-numbers"},Ms=["onClick"],Ds=["disabled"],Ss={class:"page-info"},Vs={class:"user-details"},Ps={class:"detail-row"},Es={class:"detail-value"},$s={class:"detail-row"},Bs={class:"detail-value"},Rs={class:"detail-row"},Ts={class:"detail-value"},qs={class:"detail-row"},Fs={class:"detail-value"},zs={class:"detail-row"},Is={class:"detail-value"},Qs={class:"detail-row"},js={class:"detail-value"},Os=I({__name:"Users",setup(Ys){const $=Q().$firestore,B=j(),R=O(),m=c([]),y=c(!1),p=c(null),h=c(""),d=c(1),f=c(10),g=c(null),r=c(null),w=v(()=>B.getUser?.uid||""),b=v(()=>{if(!h.value)return m.value;const e=h.value.toLowerCase();return m.value.filter(t=>t.email.toLowerCase().includes(e)||t.displayName?.toLowerCase().includes(e)||t.uid.toLowerCase().includes(e))}),_=v(()=>Math.ceil(b.value.length/f.value)),T=v(()=>{const e=(d.value-1)*f.value,t=e+f.value;return b.value.slice(e,t)}),q=v(()=>{const e=[];let a=Math.max(1,d.value-Math.floor(2.5)),o=Math.min(_.value,a+5-1);o-a<4&&(a=Math.max(1,o-5+1));for(let u=a;u<=o;u++)e.push(u);return e}),k=v(()=>m.value.length),U=v(()=>m.value.filter(e=>e.isAdmin).length),C=async()=>{y.value=!0,p.value=null;try{const e=K($,"users"),t=W(e,X("createdAt","desc")),a=await Z(t);m.value=a.docs.map(o=>{const u=o.data();return{uid:o.id,email:u.email||"",displayName:u.displayName||null,isAdmin:u.isAdmin||!1,createdAt:u.createdAt?.toDate()||null,lastLoginAt:u.lastLoginAt?.toDate()||null}})}catch(e){console.error("Error fetching users:",e),p.value="Failed to load users. Please try again."}finally{y.value=!1}},F=async e=>{if(e.uid===w.value){e.isAdmin=!e.isAdmin,alert("You cannot change your own admin status");return}g.value=e.uid;try{await R.setUserAdminStatus(e.uid,e.isAdmin)||(e.isAdmin=!e.isAdmin,alert("Failed to update admin status"))}catch(t){console.error("Error updating admin status:",t),e.isAdmin=!e.isAdmin,alert("Failed to update admin status")}finally{g.value=null}},z=e=>{r.value=e},x=()=>{r.value=null},L=()=>{d.value=1,C()},N=e=>e?new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"N/A",M=e=>e?new Date(e).toLocaleString("en-US",{month:"long",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"}):"N/A";return Y(()=>{C()}),(e,t)=>(i(),n("div",ts,[s("div",es,[t[5]||(t[5]=s("h1",null,"User Management",-1)),s("div",as,[D(s("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>h.value=a),type:"text",placeholder:"Search users...",class:"search-input"},null,512),[[G,h.value]]),s("button",{class:"btn btn-primary",onClick:L},t[4]||(t[4]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("polyline",{points:"23 4 23 10 17 10"}),s("path",{d:"M20.49 15a9 9 0 1 1-2.12-9.36L23 10"})],-1),S(" Refresh ",-1)]))])]),y.value?(i(),n("div",ls,t[6]||(t[6]=[s("div",{class:"spinner"},null,-1),S(" Loading users... ",-1)]))):p.value?(i(),n("div",ns,[s("p",null,l(p.value),1),s("button",{class:"btn btn-secondary",onClick:L}," Try Again ")])):(i(),n("div",is,[s("div",os,[s("div",ds,[t[7]||(t[7]=s("div",{class:"stat-label"},"Total Users",-1)),s("div",rs,l(k.value),1)]),s("div",us,[t[8]||(t[8]=s("div",{class:"stat-label"},"Admin Users",-1)),s("div",cs,l(U.value),1)]),s("div",vs,[t[9]||(t[9]=s("div",{class:"stat-label"},"Regular Users",-1)),s("div",ms,l(k.value-U.value),1)])]),s("div",ps,[s("table",hs,[t[13]||(t[13]=s("thead",null,[s("tr",null,[s("th",null,"Email"),s("th",null,"Display Name"),s("th",null,"Admin"),s("th",null,"Created"),s("th",null,"Last Login"),s("th",null,"Actions")])],-1)),s("tbody",null,[(i(!0),n(V,null,P(T.value,a=>(i(),n("tr",{key:a.uid},[s("td",null,[s("div",gs,l(a.email),1)]),s("td",null,[s("div",bs,l(a.displayName||"N/A"),1)]),s("td",null,[s("label",_s,[D(s("input",{"onUpdate:modelValue":o=>a.isAdmin=o,type:"checkbox",disabled:g.value===a.uid||a.uid===w.value,onChange:o=>F(a)},null,40,ys),[[H,a.isAdmin]]),t[10]||(t[10]=s("span",{class:"checkmark"},null,-1))])]),s("td",null,[s("div",fs,l(N(a.createdAt)),1)]),s("td",null,[s("div",As,l(N(a.lastLoginAt)),1)]),s("td",null,[s("div",ws,[g.value===a.uid?(i(),n("button",ks,t[11]||(t[11]=[s("div",{class:"mini-spinner"},null,-1)]))):(i(),n("button",{key:1,class:"btn-action btn-view",title:`View ${a.email}`,onClick:o=>z(a)},t[12]||(t[12]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),s("circle",{cx:"12",cy:"12",r:"3"})],-1)]),8,Us))])])]))),128))])]),b.value.length===0?(i(),n("div",Cs,t[14]||(t[14]=[s("p",null,"No users found",-1)]))):A("",!0)]),_.value>1?(i(),n("div",xs,[s("button",{class:"btn btn-page",disabled:d.value===1,onClick:t[1]||(t[1]=a=>d.value--)}," Previous ",8,Ls),s("div",Ns,[(i(!0),n(V,null,P(q.value,a=>(i(),n("button",{key:a,class:E(["btn btn-page",{active:d.value===a}]),onClick:o=>d.value=a},l(a),11,Ms))),128))]),s("button",{class:"btn btn-page",disabled:d.value===_.value,onClick:t[2]||(t[2]=a=>d.value++)}," Next ",8,Ds),s("div",Ss," Page "+l(d.value)+" of "+l(_.value)+" ("+l(b.value.length)+" users) ",1)])):A("",!0)])),r.value?(i(),n("div",{key:3,class:"modal-overlay",onClick:x},[s("div",{class:"modal",onClick:t[3]||(t[3]=J(()=>{},["stop"]))},[s("button",{class:"modal-close",onClick:x},"âœ•"),t[21]||(t[21]=s("h2",null,"User Details",-1)),s("div",Vs,[s("div",Ps,[t[15]||(t[15]=s("span",{class:"detail-label"},"UID:",-1)),s("span",Es,l(r.value.uid),1)]),s("div",$s,[t[16]||(t[16]=s("span",{class:"detail-label"},"Email:",-1)),s("span",Bs,l(r.value.email),1)]),s("div",Rs,[t[17]||(t[17]=s("span",{class:"detail-label"},"Display Name:",-1)),s("span",Ts,l(r.value.displayName||"N/A"),1)]),s("div",qs,[t[18]||(t[18]=s("span",{class:"detail-label"},"Admin Status:",-1)),s("span",Fs,[s("span",{class:E(["badge",r.value.isAdmin?"badge-admin":"badge-user"])},l(r.value.isAdmin?"Admin":"Regular User"),3)])]),s("div",zs,[t[19]||(t[19]=s("span",{class:"detail-label"},"Account Created:",-1)),s("span",Is,l(M(r.value.createdAt)),1)]),s("div",Qs,[t[20]||(t[20]=s("span",{class:"detail-label"},"Last Login:",-1)),s("span",js,l(M(r.value.lastLoginAt)),1)])])])])):A("",!0)]))}}),Js=ss(Os,[["__scopeId","data-v-fcb979f4"]]);export{Js as default};
